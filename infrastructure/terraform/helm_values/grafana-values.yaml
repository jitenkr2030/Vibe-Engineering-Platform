# Grafana Helm Chart Values
# Customize Grafana configuration for Vibe Platform

global:
  imageRegistry: ""
  imagePullSecrets: []

# Grafana Configuration
replicas: ${replicas}

# Admin credentials
admin:
  existingSecret: grafana-admin-credentials
  userKey: admin-user
  passwordKey: admin-password

# Service configuration
service:
  type: ClusterIP
  port: 80
  targetPort: 3000

# Ingress configuration
ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/auth-type: basic
    nginx.ingress.kubernetes.io/auth-secret: grafana-basic-auth
    nginx.ingress.kubernetes.io/auth-realm: "Grafana Authentication Required"
    cert-manager.io/cluster-issuer: letsencrypt-prod
  hosts:
    - monitoring.vibe.dev
  path: /
  tls:
    - secretName: grafana-tls
      hosts:
        - monitoring.vibe.dev

# Datasources configuration
datasources:
  datasources.yaml:
    apiVersion: 1
    datasources:
      - name: Prometheus
        type: prometheus
        url: http://prometheus.monitoring.svc:9090
        access: proxy
        isDefault: true
        editable: false
      - name: Loki
        type: loki
        url: http://loki.monitoring.svc:3100
        access: proxy
        editable: false
      - name: CloudWatch
        type: cloudwatch
        jsonData:
          authType: default
          defaultRegion: ${s3_region}
        editable: false

# Dashboard providers
dashboardProviders:
  dashboardproviders.yaml:
    apiVersion: 1
    providers:
      - name: 'default'
        orgId: 1
        folder: ''
        type: file
        disableDeletion: false
        editable: false
        options:
          path: /var/lib/grafana/dashboards/default

# Dashboards configuration
dashboards:
  default:
    cluster-overview:
      file: dashboards/cluster-overview.json
    application-metrics:
      file: dashboards/application-metrics.json
    database-health:
      file: dashboards/database-health.json
    redis-cache:
      file: dashboards/redis-cache.json

# LDAP Configuration (optional)
ldap:
  enabled: false

# Security configuration
securityContext:
  runAsUser: 1000
  runAsNonRoot: true
  fsGroup: 2000

# Pod configuration
pod:
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchLabels:
                app.kubernetes.io/name: grafana
            topologyKey: kubernetes.io/hostname
  tolerations:
    - key: "node-role.kubernetes.io/master"
      operator: "Exists"
      effect: "NoSchedule"

# Resource requests and limits
resources:
  requests:
    cpu: 100m
    memory: 256Mi
  limits:
    cpu: 500m
    memory: 1Gi

# Persistence configuration
persistence:
  enabled: true
  storageClassName: gp3
  size: 5Gi
  accessModes:
    - ReadWriteOnce

# Init container
initChownData:
  enabled: true

# Container lifecycle hooks
lifecycle:
  preStop:
    exec:
      command: ["/bin/sh", "-c", "sleep 10"]

# Grafana plugins
plugins:
  - grafana-clock-panel
  - grafana-simple-json-datasource
