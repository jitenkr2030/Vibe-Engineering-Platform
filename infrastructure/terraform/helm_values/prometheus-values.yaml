# Prometheus Helm Chart Values
# Customize Prometheus configuration for Vibe Platform

global:
  imageRegistry: ""
  imagePullSecrets: []

# Prometheus Configuration
prometheus:
  enabled: true
  replicaCount: ${replicas}

  service:
    type: ClusterIP
    port: 9090
    targetPort: 9090

  # Retention configuration
  retention: ${retention_time}
  retentionSize: ${retention_size}

  # Storage configuration
  storageSpec:
    volumeClaimTemplate:
      spec:
        storageClassName: gp3
        accessModes: ["ReadWriteOnce"]
        resources:
          requests:
            storage: ${storage_size}

  # Service Monitor configuration
  serviceMonitor:
    selfMonitor: true

  # Alertmanager configuration
  alertmanager:
    enabled: true
    replicaCount: ${replicas}
    retention: 120h

    service:
      type: ClusterIP
      port: 9093

  # Prometheus rules
  prometheusRules:
    enabled: true

  # Ingress configuration (optional)
  ingress:
    enabled: false
    # ingressClassName: nginx
    # annotations:
    #   nginx.ingress.kubernetes.io/auth-type: basic
    #   nginx.ingress.kubernetes.io/auth-secret: grafana-basic-auth
    # hosts:
    #   - prometheus.vibe.dev
    # paths:
    #   - /
    # tls: []

# Kube State Metrics
kube-state-metrics:
  enabled: true
  prometheus:
    monitor:
      enabled: true

# Node Exporter
node-exporter:
  enabled: true
  serviceMonitor:
    enabled: true
    relabelings:
      - action: replace
        regex: '(.*)'
        replacement: '${1}'
        sourceLabels:
          - __meta_kubernetes_pod_node_name
        targetLabel: node

# Push Gateway
prometheus-pushgateway:
  enabled: false

# Service Account Configuration
serviceAccounts:
  prometheus:
    create: true
    name: prometheus
    annotations:
      eks.amazonaws.com/role-arn: arn:aws:iam::*:role/${app_name}-prometheus-role

# Resource requests and limits
resources:
  requests:
    cpu: 200m
    memory: 512Mi
  limits:
    cpu: 1000m
    memory: 2Gi

# Pod configuration
pod:
  securityContext:
    runAsUser: 1000
    runAsNonRoot: true
    fsGroup: 2000
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchLabels:
                app.kubernetes.io/name: prometheus
            topologyKey: kubernetes.io/hostname

# Priority class
priorityClassName: system-cluster-critical

# RBAC configuration
rbac:
  create: true
